{"version":3,"sources":["src/client.js","src/utils/is.js","src/config.js","src/models/Product.js","src/models/Cart.js","src/models/Category.js","src/models/Store.js","node_modules/humps/humps.js","src/utils/objects.js","src/utils/strings.js","src/utils/form-data.js","src/utils/fetch.js","src/utils/http.js","src/utils/arrays.js","src/utils/parseUrl.js","src/utils/storage.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_defineProperty","value","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","Array","isArray","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","err","getConstructor","input","instanceOf","isObject","isNumber","Number","isNaN","isString","String","isBoolean","Boolean","isFunction","Function","isNullOrUndefined","isObjectId","test","isCurrencyCode","isEmpty","keys","isUrl","strict","arguments","window","URL","string","concat","hostname","e","is","array","object","number","boolean","function","nullOrUndefined","objectId","currencyCode","url","empty","getBase","env","config","urls","product","products","id","keyword","category","page","categories","store","buy","createCart","getCart","checkCarts","ids","addToCart","updateCartItemQuantity","removeFromCart","client","ProductUrls","a","this","assign","ProductImage","image","ProductMedia","media","cover","ProductFile","file","ProductVariant","variant","selected","ProductVariantAttributeOption","label","ProductVariantAttribute","options","map","Product","variantId","images","files","hasVariants","variants","hasVariantAttributes","variantAttributes","attribute","get","find","isProduct","CartItem","item","cartId","CartAddItem","productId","quantity","discountCode","buyersUnitPrice","Cart","cart","active","items","from","index","Category","Store","commonjsGlobal","globalThis","global","self","createCommonjsModule","fn","module","exports","humps","_processKeys","camelize","pascalize","decamelize","toString","_isFunction","_isObject","_isArray","_isDate","_isRegExp","_isBoolean","_isNumerical","_processor","convert","output","l","hasOwnProperty","call","replace","match","chr","toUpperCase","substr","toLowerCase","camelized","separator","split","join","separateWords","callback","process","depascalize","camelizeKeys","decamelizeKeys","pascalizeKeys","depascalizeKeys","apply","cloneDeep","JSON","parse","stringify","extend","b","sources","d","source","shift","forEach","includes","parseJSON","data","Promise","resolve","reject","error","replaceAll","RegExp","toTitleCase","text","charAt","toPascalCase","buildFormData","formKey","form","namespace","formData","FormData","File","append","defaults","type","body","responseType","fetch","c","xhr","XMLHttpRequest","Error","request","fail","status","addEventListener","response","then","json","success","errors","catch","open","send","queue","http","remove","post","dedupe","filter","indexOf","parseUrl","storage","Map","getKey","parsed","host","pathname","Storage","root","carts","stores","ttl","schema","Date","getTime","purge","supported","stored","localStorage","getItem","merge","set","setItem","removeItem","now","currency","getCarts","s","existing","Client","getStore","cached","setStore","getStoreId","p","cartItem","discount","setCart","currentCart","isCurrency","getCartId","activeId","getActiveCart","validate","entries","setCarts","values","setActiveCart","currencies"],"mappings":"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","file":"client.mjs","sourcesContent":["import config from './config';\nimport { Cart, CartAddItem, CartItem } from './models/Cart';\nimport Category from './models/Category';\nimport Product from './models/Product';\nimport Store from './models/Store';\nimport http from './utils/http';\nimport is from './utils/is';\nimport Storage from './utils/storage';\n\nclass Client {\n    constructor(props) {\n        const { env, store, source } = props;\n\n        this.env = !is.empty(env) ? env : '';\n        this.store = store;\n        this.source = source;\n\n        if (!is.url(store) && !is.number(store)) {\n            throw Error('A store ID or URL is required to create a client');\n        }\n\n        this.storage = new Storage();\n    }\n\n    /**\n     * Get the store ID only\n     */\n    getStoreId() {\n        return new Promise((resolve, reject) => {\n            if (is.number(this.store)) {\n                resolve(this.store);\n                return;\n            }\n\n            if (this.store instanceof Store) {\n                resolve(this.store.id);\n                return;\n            }\n\n            // URL is required\n            if (!is.url(this.store)) {\n                reject(new Error('Url is required for user lookup'));\n            }\n\n            // Get by URL\n            this.getStore()\n                .then(store => {\n                    resolve(store.id);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the Store for current instance\n     */\n    getStore() {\n        return new Promise((resolve, reject) => {\n            // Try from cache by ID or URL\n            if (is.number(this.store) || is.url(this.store)) {\n                const cached = this.storage.getStore(this.store);\n\n                // Return cached if we have it\n                if (cached !== null && cached instanceof Store) {\n                    resolve(cached);\n                    return;\n                }\n            }\n\n            // If already fetched\n            if (this.store instanceof Store) {\n                resolve(this.store);\n                return;\n            }\n\n            // Fetch from remote by ID or URL\n            const url = config.urls.store(this.env, this.store);\n\n            http.get(url)\n                .then(store => {\n                    this.setStore(store);\n                    resolve(this.store);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the store details\n     * @param {object} store\n     */\n    setStore(store) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Store reference to lookup URL\n        const url = is.url(this.store) ? this.store : null;\n\n        // Map to Store\n        this.store = new Store(store);\n\n        // Add to storage for cache\n        this.storage.setStore(this.store, url);\n    }\n\n    /**\n     * Get product data\n     * @param {String} url - Short or full URL for a product\n     */\n    getProduct(url) {\n        return new Promise((resolve, reject) => {\n            http.get(config.urls.product(this.env, url))\n                .then(json => {\n                    if (!(this.store instanceof Store)) {\n                        this.setStore(json.store);\n                    }\n\n                    resolve(new Product(this, json));\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get all products\n     */\n    getProducts(keyword = '', category = '', page = 1) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    http.get(\n                        config.urls.products(\n                            this.env,\n                            id,\n                            !is.empty(keyword) ? keyword : '',\n                            is.string(category) ? category : '',\n                            !is.number(page) || page < 1 ? 1 : page,\n                        ),\n                    )\n                        .then(json => {\n                            resolve(\n                                Object.assign({}, json, {\n                                    products: json.products.map(p => new Product(this, p)),\n                                }),\n                            );\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get all categories\n     */\n    getCategories() {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    http.get(config.urls.categories(this.env, id))\n                        .then(json => {\n                            resolve(\n                                Object.assign({}, json, {\n                                    categories: json.categories.map(c => new Category(c)),\n                                }),\n                            );\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Buy a product\n     * @param {Object} item - The cart item\n     * @returns {Cart}\n     */\n    buy(item) {\n        return new Promise((resolve, reject) => {\n            if (is.empty(item)) {\n                reject(new Error('A cart item is required'));\n                return;\n            }\n\n            // Map the cart item if required\n            let cartItem = item;\n            if (is.object(item) || item instanceof Product) {\n                cartItem = new CartAddItem(item);\n            }\n\n            if (!(cartItem instanceof CartAddItem)) {\n                reject(new Error('A valid cart item is required'));\n            }\n\n            http.post(config.urls.buy(this.env), cartItem)\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Cache store\n                    this.setStore(cart.store);\n\n                    resolve(cart);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Create a new shopping cart\n     * @param {String} currency - ISO currency code\n     * @param {String} discount - Discount code\n     */\n    createCart(currency, discount) {\n        return new Promise((resolve, reject) => {\n            if (is.empty(currency)) {\n                reject(new Error('currency is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n\n                    http.post(config.urls.createCart(this.env, id), {\n                        currency: currencyCode,\n                        discount: !is.empty(discount) ? discount : null,\n                        source: this.source,\n                    })\n                        .then(json => {\n                            const cart = new Cart(this, json);\n\n                            // Store reference to cart id for later\n                            this.storage.setCart(id, currencyCode, cart);\n\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart or create one if needed\n     * @param {String} currency - The shopping cart ISO currency code\n     */\n    getCartId(currency) {\n        return new Promise((resolve, reject) => {\n            if (!is.currencyCode(currency)) {\n                reject(new Error('A valid currency code is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n                    const currentCart = this.storage.getCart(id, currencyCode);\n\n                    // Create cart if it doesn't exist\n                    if (is.empty(currentCart)) {\n                        this.createCart(currencyCode)\n                            .then(cart => resolve(cart.id))\n                            .catch(reject);\n                    } else {\n                        resolve(currentCart.id);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart\n     * @param {String} input - The shopping cart ISO currency code or cart ID\n     */\n    getCart(input) {\n        return new Promise((resolve, reject) => {\n            const isCurrency = is.currencyCode(input);\n            const isObjectId = is.objectId(input);\n\n            if (!isCurrency && !isObjectId) {\n                reject(new Error('A valid currency code or cart id are required'));\n                return;\n            }\n\n            if (isCurrency) {\n                const currencyCode = input.toUpperCase();\n\n                this.getCartId(currencyCode)\n                    .then(id => {\n                        if (is.empty(id)) {\n                            reject(new Error(`Could not find matching cart for currency code '${currencyCode}'`));\n                            return;\n                        }\n\n                        this.getCart(id)\n                            .then(cart => {\n                                // Update store\n                                this.setStore(cart.store);\n\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    })\n                    .catch(reject);\n            } else {\n                http.get(config.urls.getCart(this.env, input))\n                    .then(json => {\n                        const activeId = this.getActiveCart();\n                        const cart = new Cart(this, json, json.id === activeId);\n\n                        // Update store\n                        this.setStore(cart.store);\n\n                        resolve(cart);\n                    })\n                    .catch(reject);\n            }\n        });\n    }\n\n    /**\n     * Get all current carts\n     */\n    getCarts(validate = true) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (is.empty(carts)) {\n                        resolve(null);\n                        return;\n                    }\n\n                    // Check the carts still exist in the server\n                    if (validate) {\n                        const ids = Object.keys(carts).map(currency => carts[currency].id);\n\n                        http.get(config.urls.checkCarts(this.env, ids.join(',')))\n                            .then(json => {\n                                // Remove non existant carts\n                                Object.entries(json).forEach(([cartId, exists]) => {\n                                    if (!exists) {\n                                        const currency = Object.keys(carts).find(c => carts[c].id === cartId);\n                                        delete carts[currency];\n                                    }\n                                });\n\n                                // Store again\n                                this.storage.setCarts(id, carts);\n\n                                // Set active\n                                if (!Object.values(carts).find(cart => cart.active)) {\n                                    this.setActiveCart()\n                                        .then(resolve)\n                                        .catch(reject);\n                                } else {\n                                    resolve(carts);\n                                }\n                            })\n                            .catch(reject);\n                    } else {\n                        resolve(carts);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the active cart based on currency\n     * @param {String} input - The shopping cart ISO currency code or cart ID\n     */\n    setActiveCart(input = null) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    this.getCarts(false).then(data => {\n                        const carts = data;\n\n                        // No carts\n                        if (is.empty(carts)) {\n                            resolve(null);\n                            return;\n                        }\n\n                        // Currency code was passed...\n                        if (is.currencyCode(input)) {\n                            const currencyCode = input.toUpperCase();\n                            const currencies = Object.keys(carts);\n\n                            // Bail if not included\n                            if (!currencies.includes(currencyCode)) {\n                                reject(new Error(`No carts for ${currencyCode}`));\n                                return;\n                            }\n\n                            // Set active\n                            currencies.forEach(currency => {\n                                carts[currency].active = currency === currencyCode;\n                            });\n                        } else {\n                            // Set to id if specified, otherwise first\n                            const cartId = is.objectId(input) ? input : carts[Object.keys(carts)[0]].id;\n\n                            // Set active\n                            Object.keys(carts).forEach(currency => {\n                                const cart = carts[currency];\n                                cart.active = cart.id === cartId;\n                            });\n                        }\n\n                        // Store again\n                        this.storage.setCarts(id, carts);\n\n                        resolve(carts);\n                    });\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the current active cart\n     */\n    getActiveCart(fetch = false) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (!Object.keys(carts).length) {\n                        resolve(null);\n                        return;\n                    }\n\n                    const active = Object.values(carts).find(cart => cart.active);\n\n                    if (!active) {\n                        resolve(null);\n                        return;\n                    }\n\n                    if (!fetch) {\n                        resolve(active.id);\n                        return;\n                    }\n\n                    this.getCart(active.id)\n                        .then(resolve)\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Add a product to a cart\n     * @param {String} id - The cart ID\n     * @param {Object} item - The cart item\n     */\n    addToCart(id, item) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(item)) {\n                reject(new Error('A cart item is required'));\n                return;\n            }\n\n            // Map the cart item if required\n            let cartItem = item;\n            if (is.object(item) || item instanceof Product) {\n                cartItem = new CartAddItem(item);\n            }\n\n            if (!(cartItem instanceof CartAddItem)) {\n                reject(new Error('A valid cart item is required'));\n            }\n\n            http.post(config.urls.addToCart(this.env, id), cartItem)\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Update an items quantity in the shopping cart\n     * @param {String} id - The shopping cart ID\n     * @param {String} index - The shopping cart item quid\n     * @param {Number} quantity - Desired quantity\n     */\n    updateCartItemQuantity(id, index, quantity = 1) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.updateCartItemQuantity(this.env, id), { index, quantity })\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Remove a product from a cart\n     * @param {String} id - The shopping cart id\n     * @param {String} index - The shopping cart item guid\n     */\n    removeFromCart(id, index) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.removeFromCart(this.env, id), { index })\n                .then(json => {\n                    // If there's actually a cart left, map it\n                    if (!is.empty(json)) {\n                        const cart = new Cart(this, json, true);\n\n                        // Set the active cart\n                        this.setActiveCart(cart.id)\n                            .then(() => {\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    } else {\n                        // Otherwise, update carts (as one removed)\n                        this.getCarts()\n                            .then(() => resolve(null))\n                            .catch(reject);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n}\n\nexport { Product, Category, Cart, CartItem, CartAddItem, Store };\n\nexport default Client;\n","// ==========================================================================\n// Type checking\n// ==========================================================================\n\nconst getConstructor = input => (input !== null && typeof input !== 'undefined' ? input.constructor : null);\nconst instanceOf = (input, constructor) => Boolean(input && constructor && input instanceof constructor);\nconst isArray = input => Array.isArray(input);\nconst isObject = input => getConstructor(input) === Object;\nconst isNumber = input => getConstructor(input) === Number && !Number.isNaN(input);\nconst isString = input => getConstructor(input) === String;\nconst isBoolean = input => getConstructor(input) === Boolean;\nconst isFunction = input => getConstructor(input) === Function;\nconst isNullOrUndefined = input => input === null || typeof input === 'undefined';\nconst isObjectId = input => isString(input) && /^[a-f\\d]{24}$/i.test(input);\nconst isCurrencyCode = input => isString(input) && /^[A-z]{3}$/.test(input);\n\nconst isEmpty = input =>\n    isNullOrUndefined(input) ||\n    ((isString(input) || isArray(input)) && !input.length) ||\n    (isObject(input) && !Object.keys(input).length);\n\nconst isUrl = (input, strict = false) => {\n    // Accept a URL object\n    if (instanceOf(input, window.URL)) {\n        return true;\n    }\n\n    // Add the protocol if required\n    let string = input;\n    if (!strict && !/^https?:\\/\\/*/.test(input)) {\n        string = `http://${input}`;\n    }\n\n    try {\n        return !isEmpty(new URL(string).hostname);\n    } catch (e) {\n        return false;\n    }\n};\n\nconst is = {\n    array: isArray,\n    object: isObject,\n    number: isNumber,\n    string: isString,\n    boolean: isBoolean,\n    function: isFunction,\n    nullOrUndefined: isNullOrUndefined,\n    objectId: isObjectId,\n    currencyCode: isCurrencyCode,\n    url: isUrl,\n    empty: isEmpty,\n};\n\nexport default is;\n","import is from './utils/is';\n\nconst getBase = env => `https://${is.empty(env) || env === 'selz.com' ? 'sdk.selz.com' : `${env}/sdk`}/`;\n\nconst config = {\n    urls: {\n        /**\n         * Get URL for product data by URL\n         * @param {String} env - Environment (for internal use)\n         * @param {String} url - Short or full URL for a product\n         */\n        product(env, url = '') {\n            return `${getBase(env)}products/find?url=${url}`;\n        },\n\n        /**\n         * Get URL for all products by store ID\n         * @param {String} env - Environment (for internal use)\n         * @param {Number|String} id - The store ID\n         * @param {String} keyword - Search keyword\n         * @param {ObjectId|String} category - Category ID or relative path\n         * @param {Number} page - Page to fetch\n         */\n        products(env, id, keyword = '', category = '', page = 1) {\n            return `${getBase(env)}products/all/${id}?q=${keyword}&c=${category}&p=${page}`;\n        },\n\n        /**\n         * Get all categories for a given store ID\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - The store ID\n         */\n        categories(env, id) {\n            return `${getBase(env)}categories/${id}`;\n        },\n\n        /**\n         * Get URL for finding a store by URL or ID\n         * @param {String} env - Environment (for internal use)\n         * @param {Number|String} input - The ID or URL to lookup\n         */\n        store(env, input = null) {\n            if (is.number(input)) {\n                return `${getBase(env)}store/find/${input}`;\n            }\n\n            return `${getBase(env)}store/find?url=${input}`;\n        },\n\n        /**\n         * Buy a product\n         * @param {String} env - Environment (for internal use)\n         */\n        buy(env) {\n            return `${getBase(env)}cart/buy`;\n        },\n\n        /**\n         * Create a new cart\n         * @param {String} env - Environment (for internal use)\n         * @param {Number} id - Store ID\n         */\n        createCart(env, id = '') {\n            return `${getBase(env)}cart/create/${id}`;\n        },\n\n        /**\n         * Get cart from ID\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        getCart(env, id = '') {\n            return `${getBase(env)}cart/${id}`;\n        },\n\n        /**\n         * Check carts still exist server side\n         * @param {String} env - Environment (for internal use)\n         * @param {Number} id - Cart IDs\n         */\n        checkCarts(env, ids = '') {\n            return `${getBase(env)}cart/verify?ids=${ids}`;\n        },\n\n        /**\n         * Add product to cart\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        addToCart(env, id = '') {\n            return `${getBase(env)}cart/add/${id}`;\n        },\n\n        /**\n         * Update a cart item quantity\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        updateCartItemQuantity(env, id = '') {\n            return `${getBase(env)}cart/updateitemquantity/${id}`;\n        },\n\n        /**\n         * Remove product from cart\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        removeFromCart(env, id = '') {\n            return `${getBase(env)}cart/remove/${id}`;\n        },\n    },\n};\n\nexport default config;\n","import is from '../utils/is';\n\nlet client = null;\n\nclass ProductUrls {\n    constructor(urls) {\n        // Take all properties by default\n        Object.assign(this, urls);\n    }\n}\n\nclass ProductImage {\n    constructor(image) {\n        // Take all properties by default\n        Object.assign(this, image);\n    }\n}\n\nclass ProductMedia {\n    constructor(media) {\n        // Take all properties by default\n        Object.assign(this, media);\n\n        // Map cover image\n        this.cover = new ProductImage(media.cover);\n    }\n}\n\nclass ProductFile {\n    constructor(file) {\n        // Take all properties by default\n        Object.assign(this, file);\n    }\n}\n\nclass ProductVariant {\n    constructor(variant, selected = '') {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        this.selected = variant.id === selected;\n    }\n}\n\nclass ProductVariantAttributeOption {\n    constructor(id, label) {\n        this.id = id;\n        this.label = label;\n    }\n}\n\nclass ProductVariantAttribute {\n    constructor(variant) {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        // Map options\n        this.options = Object.keys(variant.options).map(\n            id => new ProductVariantAttributeOption(id, variant.options[id]),\n        );\n    }\n}\n\nclass Product {\n    constructor(instance, product, variantId = '') {\n        if (!is.object(product)) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, product);\n\n        // Map store\n        this.store = client.store;\n\n        // Product URLs\n        if (is.object(product.urls)) {\n            this.urls = new ProductUrls(product.urls);\n        }\n\n        // Media (Video, YouTube, Vimeo, Audio)\n        if (is.object(product.media)) {\n            this.media = new ProductMedia(product.media);\n        }\n\n        // Images\n        if (is.array(product.images)) {\n            this.images = product.images.map(image => new ProductImage(image));\n        }\n\n        // Files for digital products\n        if (is.array(product.files)) {\n            this.files = product.files.map(file => new ProductFile(file));\n        }\n\n        // Variants\n        if (product.hasVariants) {\n            const selected = !is.empty(variantId) ? variantId : product.variants[0].id;\n            this.variants = product.variants.map(variant => new ProductVariant(variant, selected));\n        }\n        if (product.hasVariantAttributes) {\n            this.variantAttributes = product.variantAttributes.map(attribute => new ProductVariantAttribute(attribute));\n        }\n    }\n\n    get selectedVariant() {\n        if (is.empty(this.variants)) {\n            return null;\n        }\n\n        return this.variants.find(variant => variant.selected);\n    }\n}\n\nexport default Product;\n","import is from '../utils/is';\nimport Product from './Product';\n\nlet client = null;\nconst isProduct = input => !is.empty(input) && input instanceof Product;\n\nexport class CartItem {\n    constructor(item, cartId) {\n        this.cartId = cartId;\n\n        // Take all properties by default\n        Object.assign(this, item);\n\n        // Map product\n        this.product = new Product(client, item.product, item.variantId);\n    }\n}\n\nexport class CartAddItem {\n    constructor(item) {\n        this.productId = null;\n        this.variantId = null;\n        this.quantity = 1;\n        this.discountCode = null;\n        this.buyersUnitPrice = null;\n\n        if (isProduct(item) || is.object(item)) {\n            this.productId = item.id;\n            this.variantId = is.objectId(item.variant) ? item.variant : null;\n        }\n    }\n}\n\nexport class Cart {\n    constructor(instance, cart, active = false) {\n        if (cart === null) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, cart);\n\n        // Map store\n        this.store = client.store;\n\n        // Set active state\n        this.active = active;\n\n        // Map items\n        this.items = Array.from(cart.items).map(item => new CartItem(item, cart.id));\n    }\n\n    /**\n     * Add a product to this cart\n     * @param {Object} item - The cart item\n     */\n    add(item) {\n        return client.addToCart(this.id, item);\n    }\n\n    /**\n     * Remove a product from this cart\n     * @param {String} index\n     */\n    remove(index) {\n        return client.removeFromCart(this.id, index);\n    }\n}\n\nexport default Cart;\n","import is from '../utils/is';\n\nclass Category {\n    constructor(category = null) {\n        if (!is.object(category)) {\n            return;\n        }\n\n        // Take all properties by default\n        Object.assign(this, category);\n    }\n}\n\nexport default Category;\n","import is from '../utils/is';\n\nclass Store {\n    constructor(store = null) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Take all properties by default\n        Object.assign(this, store);\n    }\n}\n\nexport default Store;\n","// =========\n// = humps =\n// =========\n// Underscore-to-camelCase converter (and vice versa)\n// for strings and object keys\n\n// humps is copyright  2012+ Dom Christie\n// Released under the MIT license.\n\n\n;(function(global) {\n\n  var _processKeys = function(convert, obj, options) {\n    if(!_isObject(obj) || _isDate(obj) || _isRegExp(obj) || _isBoolean(obj) || _isFunction(obj)) {\n      return obj;\n    }\n\n    var output,\n        i = 0,\n        l = 0;\n\n    if(_isArray(obj)) {\n      output = [];\n      for(l=obj.length; i<l; i++) {\n        output.push(_processKeys(convert, obj[i], options));\n      }\n    }\n    else {\n      output = {};\n      for(var key in obj) {\n        if(Object.prototype.hasOwnProperty.call(obj, key)) {\n          output[convert(key, options)] = _processKeys(convert, obj[key], options);\n        }\n      }\n    }\n    return output;\n  };\n\n  // String conversion methods\n\n  var separateWords = function(string, options) {\n    options = options || {};\n    var separator = options.separator || '_';\n    var split = options.split || /(?=[A-Z])/;\n\n    return string.split(split).join(separator);\n  };\n\n  var camelize = function(string) {\n    if (_isNumerical(string)) {\n      return string;\n    }\n    string = string.replace(/[\\-_\\s]+(.)?/g, function(match, chr) {\n      return chr ? chr.toUpperCase() : '';\n    });\n    // Ensure 1st char is always lowercase\n    return string.substr(0, 1).toLowerCase() + string.substr(1);\n  };\n\n  var pascalize = function(string) {\n    var camelized = camelize(string);\n    // Ensure 1st char is always uppercase\n    return camelized.substr(0, 1).toUpperCase() + camelized.substr(1);\n  };\n\n  var decamelize = function(string, options) {\n    return separateWords(string, options).toLowerCase();\n  };\n\n  // Utilities\n  // Taken from Underscore.js\n\n  var toString = Object.prototype.toString;\n\n  var _isFunction = function(obj) {\n    return typeof(obj) === 'function';\n  };\n  var _isObject = function(obj) {\n    return obj === Object(obj);\n  };\n  var _isArray = function(obj) {\n    return toString.call(obj) == '[object Array]';\n  };\n  var _isDate = function(obj) {\n    return toString.call(obj) == '[object Date]';\n  };\n  var _isRegExp = function(obj) {\n    return toString.call(obj) == '[object RegExp]';\n  };\n  var _isBoolean = function(obj) {\n    return toString.call(obj) == '[object Boolean]';\n  };\n\n  // Performant way to determine if obj coerces to a number\n  var _isNumerical = function(obj) {\n    obj = obj - 0;\n    return obj === obj;\n  };\n\n  // Sets up function which handles processing keys\n  // allowing the convert function to be modified by a callback\n  var _processor = function(convert, options) {\n    var callback = options && 'process' in options ? options.process : options;\n\n    if(typeof(callback) !== 'function') {\n      return convert;\n    }\n\n    return function(string, options) {\n      return callback(string, convert, options);\n    }\n  };\n\n  var humps = {\n    camelize: camelize,\n    decamelize: decamelize,\n    pascalize: pascalize,\n    depascalize: decamelize,\n    camelizeKeys: function(object, options) {\n      return _processKeys(_processor(camelize, options), object);\n    },\n    decamelizeKeys: function(object, options) {\n      return _processKeys(_processor(decamelize, options), object, options);\n    },\n    pascalizeKeys: function(object, options) {\n      return _processKeys(_processor(pascalize, options), object);\n    },\n    depascalizeKeys: function () {\n      return this.decamelizeKeys.apply(this, arguments);\n    }\n  };\n\n  if (typeof define === 'function' && define.amd) {\n    define(humps);\n  } else if (typeof module !== 'undefined' && module.exports) {\n    module.exports = humps;\n  } else {\n    global.humps = humps;\n  }\n\n})(this);\n","// ==========================================================================\n// Extend objects\n// ==========================================================================\n\nimport is from './is';\n\n/**\n * Clone nested objects\n * @param {object} object\n */\nexport function cloneDeep(object) {\n    return JSON.parse(JSON.stringify(object));\n}\n\n/**\n * Deep extend destination object with N more objects\n * @param {Object} target\n * @param {...Object} sources\n */\nexport function extend(target = {}, ...sources) {\n    if (!sources.length) {\n        return target;\n    }\n\n    const source = sources.shift();\n\n    if (!is.object(source)) {\n        return target;\n    }\n\n    Object.keys(source).forEach(key => {\n        if (is.object(source[key])) {\n            if (!Object.keys(target).includes(key)) {\n                Object.assign(target, { [key]: {} });\n            }\n\n            extend(target[key], source[key]);\n        } else {\n            Object.assign(target, { [key]: source[key] });\n        }\n    });\n\n    return extend(target, ...sources);\n}\n\n/**\n * Safer JSON parsing\n * @param {Object} data\n */\nexport function parseJSON(data = {}) {\n    return new Promise((resolve, reject) => {\n        try {\n            resolve(JSON.parse(data));\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n","// ==========================================================================\n// String utils\n// ==========================================================================\n\n// Replace all occurances of a string in a string\nexport function replaceAll(input = '', find = '', replace = '') {\n    return input.replace(\n        new RegExp(find.toString().replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1'), 'g'),\n        replace.toString(),\n    );\n}\n\n// Convert to title case\nexport function toTitleCase(input = '') {\n    return input.toString().replace(/\\w\\S*/g, text => text.charAt(0).toUpperCase() + text.substr(1).toLowerCase());\n}\n\n// Convert string to pascalCase\nexport function toPascalCase(input = '') {\n    let string = input.toString();\n\n    // Convert kebab case\n    string = replaceAll(string, '-', ' ');\n\n    // Convert snake case\n    string = replaceAll(string, '_', ' ');\n\n    // Convert to title case\n    string = toTitleCase(string);\n\n    // Convert to pascal case\n    return replaceAll(string, ' ', '');\n}\n\n// Convert string to pascalCase\nexport function toCamelCase(input = '') {\n    let string = input.toString();\n\n    // Convert to pascal case\n    string = toPascalCase(string);\n\n    // Convert first character to lowercase\n    return string.charAt(0).toLowerCase() + string.slice(1);\n}\n","// ==========================================================================\n// Form Data utils\n// ==========================================================================\n\nimport is from './is';\nimport { cloneDeep } from './objects';\nimport { toPascalCase } from './strings';\n\n/**\n * Convert an Object to FormData\n * @param {Object} source - source Object\n * @param {FormData} form - existing FormData object\n * @param {String} namespace - namespace for FormData\n */\nconst buildFormData = (source = {}, form, namespace) => {\n    const formData = form || new FormData();\n    let formKey;\n    let data = null;\n\n    // Parse as an object\n    try {\n        data = cloneDeep(source);\n    } catch (error) {\n        return formData;\n    }\n\n    // Source must be an object\n    if (!is.object(data)) {\n        return formData;\n    }\n\n    // Loop through the object to convert\n    Object.keys(data).forEach(key => {\n        if (namespace) {\n            formKey = `${namespace}[${key}]`;\n        } else {\n            formKey = key;\n        }\n\n        // If the property is an object, but not a File, use recursivity\n        if (typeof source[key] === 'object' && !(source[key] instanceof File)) {\n            buildFormData(source[key], formData, key);\n        } else {\n            formData.append(toPascalCase(formKey), source[key]);\n        }\n    });\n\n    return formData;\n};\n\nexport default buildFormData;\n","// ==========================================================================\n// Fetch\n// ==========================================================================\n\nimport humps from 'humps';\n\nimport buildFormData from './form-data';\nimport { extend, parseJSON } from './objects';\n\nconst defaults = {\n    type: 'GET',\n    body: {},\n    responseType: 'json',\n};\n\n/**\n * Custom immitation fetch using XHR\n * @param {String} url - The URL of the endpoint\n * @param {Object} options - Object of options for the request\n */\nexport default function(url, options = {}) {\n    const { type, body, responseType } = extend({}, defaults, options);\n\n    return new Promise((resolve, reject) => {\n        try {\n            const xhr = new XMLHttpRequest();\n\n            // Check for CORS support\n            if (!('withCredentials' in xhr)) {\n                const error = new Error('No CORS support');\n                error.request = xhr;\n                throw error;\n            }\n\n            // Handle failures\n            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/status\n            const fail = () => {\n                const error = new Error(xhr.status);\n                error.request = xhr;\n                reject(error);\n            };\n\n            // Successfully made the request\n            xhr.addEventListener('load', () => {\n                const { response } = xhr;\n\n                // Something went wrong either with the request or server\n                if (xhr.status >= 400) {\n                    fail();\n                    return;\n                }\n\n                // Parse JSON responses\n                if (responseType === 'json') {\n                    parseJSON(response)\n                        .then(json => {\n                            if (json.success) {\n                                const data = humps.camelizeKeys(json.data);\n                                resolve(data);\n                            } else {\n                                const error = new Error('Request failed');\n                                error.errors = json.errors;\n                                reject(error);\n                            }\n                        })\n                        .catch(reject);\n                } else {\n                    resolve(response);\n                }\n            });\n\n            // Request failed\n            xhr.addEventListener('error', fail);\n\n            // Start the request\n            xhr.open(type, url, true);\n\n            // Set the required response type\n            // 'json' responseType is much slower, so we parse later\n            // https://github.com/arendjr/fetch-vs-xhr-perf\n            if (responseType !== 'json') {\n                xhr.responseType = responseType;\n            }\n\n            // Send data if passed\n            xhr.send(buildFormData(body));\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n","// ==========================================================================\n// Common fetch actions\n// ==========================================================================\n\nimport fetch from './fetch';\n\nconst queue = {};\n\nconst http = {\n    /**\n     * GET remote URL and parse as JSON\n     * @param {String} url - The endpoint URL\n     */\n    get(url) {\n        // Queue requests to prevent hammering\n        if (!Object.keys(queue).includes(url)) {\n            queue[url] = fetch(url);\n\n            const remove = () => {\n                delete queue[url];\n            };\n\n            // Remove from queue on completed\n            queue[url].then(remove).catch(remove);\n        }\n\n        return queue[url];\n    },\n\n    /**\n     * POST to remote URL and parse as JSON\n     * @param {String} url - The endpoint URL\n     * @param {Object} data - The POST data payload\n     */\n    post(url, data = {}) {\n        const options = {\n            type: 'POST',\n            body: data,\n        };\n\n        return fetch(url, options);\n    },\n};\n\nexport default http;\n","// ==========================================================================\n// Array utils\n// ==========================================================================\n\nimport is from './is';\n\n/**\n * Remove duplicates in an array\n * @param {array} array\n */\nexport function dedupe(array) {\n    if (!is.array(array)) {\n        return array;\n    }\n\n    return array.filter((item, index) => array.indexOf(item) === index);\n}\n\n// Rounding methods for .closest()\nconst closestRounding = {\n    none: 0,\n    ceil: 1,\n    floor: 2,\n};\nexport { closestRounding };\n\n/**\n * Get the closest value in an array\n * @param {array} array\n * @param {number} value\n * @param {number} rounding\n */\nexport function closest(array, value, rounding = closestRounding.none) {\n    if (!is.array(array) || !array.length) {\n        return null;\n    }\n\n    return array.reduce((prev, curr) => {\n        if (Math.abs(curr - value) <= Math.abs(prev - value)) {\n            switch (rounding) {\n                case closestRounding.ceil:\n                    return curr >= value ? curr : prev;\n\n                case closestRounding.floor:\n                    return curr <= value ? curr : prev;\n\n                default:\n                    return curr;\n            }\n        }\n\n        return prev;\n    });\n}\n","/**\n * Parse a string to URL object\n * @param {String} url\n */\nexport default function parseUrl(url) {\n    let string = url;\n\n    // Add the protocol if required\n    if (!/^https?:\\/\\/*/.test(url)) {\n        string = `http://${url}`;\n    }\n\n    try {\n        return new URL(string);\n    } catch (e) {\n        return null;\n    }\n}\n","// ==========================================================================\n// Local storage wrapper\n// TODO: methods should return promises?\n// ==========================================================================\n\nimport Store from '../models/Store';\nimport { dedupe } from './arrays';\nimport is from './is';\nimport { extend } from './objects';\nimport parseUrl from './parseUrl';\n\nconst storage = new Map();\n\nconst getKey = url => {\n    if (url === null) {\n        return null;\n    }\n\n    const parsed = parseUrl(url);\n\n    if (parsed === null) {\n        return null;\n    }\n\n    return `${parsed.host}${parsed.pathname}`.replace(/\\/$/, '');\n};\n\nclass Storage {\n    constructor(config) {\n        this.config = Object.assign(\n            {\n                keys: {\n                    root: 'selz-js-sdk',\n                    carts: 'carts',\n                    stores: 'stores',\n                },\n                ttl: 3600, // 1 hour\n                schema: new Date('2018-07-02').getTime(), // Schema version (allowing us to change data schema and invalidate storage)\n            },\n            config,\n        );\n\n        this.purge();\n    }\n\n    // Check for actual support (see if we can use it)\n    static get supported() {\n        if (!window.localStorage) {\n            return false;\n        }\n\n        const key = '___test';\n\n        // Try to use it\n        try {\n            window.localStorage.setItem(key, key);\n            window.localStorage.removeItem(key);\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    get(key) {\n        let data = storage.get(this.config.keys.root);\n\n        // Grab from real storage if we can or use faux-storage\n        if (Storage.supported) {\n            const stored = window.localStorage.getItem(this.config.keys.root);\n\n            if (!is.empty(stored)) {\n                data = JSON.parse(stored);\n            }\n        }\n\n        if (is.empty(data)) {\n            return null;\n        }\n\n        if (!is.empty(key)) {\n            return Object.keys(data).includes(key) ? data[key] : null;\n        }\n\n        return data;\n    }\n\n    set(key, value, merge = false) {\n        // Get current storage\n        const data = this.get() || {};\n\n        // Extend with the new data\n        if (merge && Object.keys(data).includes(key)) {\n            data[key] = extend(data[key], value);\n        } else {\n            data[key] = value;\n        }\n\n        // Set in faux-storage\n        storage.set(this.config.keys.root, data);\n\n        // Bail if no real support\n        if (!Storage.supported) {\n            return;\n        }\n\n        // Set schema version\n        data.schema = this.config.schema;\n\n        // Update storage\n        try {\n            window.localStorage.setItem(this.config.keys.root, JSON.stringify(data));\n        } catch (e) {\n            // Do nothing\n        }\n    }\n\n    // Clean up stale storage\n    purge() {\n        // Check schema\n        const data = this.get();\n\n        // Nothing to purge\n        if (is.empty(data)) {\n            return;\n        }\n\n        // If schema does not match, kill it\n        if (Number(data.schema) !== this.config.schema) {\n            window.localStorage.removeItem(this.config.keys.root);\n            return;\n        }\n\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n\n        // Nothing to cleanup\n        if (is.empty(stores)) {\n            return;\n        }\n\n        // Check TTL is valid\n        this.set(\n            this.config.keys.stores,\n            stores.filter(store => {\n                const ttl = Number(store.ttl);\n                return ttl > 0 && ttl > Date.now();\n            }),\n        );\n    }\n\n    getCarts(store) {\n        const data = this.get(this.config.keys.carts) || {};\n\n        // If no carts\n        if (is.empty(data)) {\n            return null;\n        }\n\n        // Get all carts\n        if (!is.number(store)) {\n            return data;\n        }\n\n        // Store not found\n        if (!Object.keys(data).includes(store.toString())) {\n            return null;\n        }\n\n        // Get all for a store\n        return data[store.toString()];\n    }\n\n    getCart(store, currency) {\n        const carts = this.getCarts(store);\n\n        // No carts\n        if (is.empty(carts)) {\n            return null;\n        }\n\n        // Get all for a store\n        if (!is.string(currency)) {\n            return carts;\n        }\n\n        // Currency not found\n        if (!Object.keys(carts).includes(currency.toUpperCase())) {\n            return null;\n        }\n\n        return carts[currency.toUpperCase()];\n    }\n\n    setCart(store, currency, cart) {\n        this.set(\n            this.config.keys.carts,\n            {\n                [store]: {\n                    [currency.toUpperCase()]: {\n                        id: cart.id,\n                        active: cart.active,\n                    },\n                },\n            },\n            true,\n        );\n    }\n\n    setCarts(store, carts = {}) {\n        this.set(this.config.keys.carts, {\n            [store]: carts,\n        });\n    }\n\n    getStore(input) {\n        let store = null;\n\n        if (!is.number(input) && !is.url(input)) {\n            return null;\n        }\n\n        const stores = this.get(this.config.keys.stores) || [];\n\n        if (is.number(input)) {\n            store = stores.find(s => is.object(s.data) && s.data.id === input);\n        } else if (is.url(input)) {\n            const key = getKey(input);\n\n            // Bail if invalid URL\n            if (key === null) {\n                return null;\n            }\n\n            store = stores.find(s => is.array(s.urls) && s.urls.includes(key));\n        }\n\n        if (!is.object(store)) {\n            return null;\n        }\n\n        // Check TTL is valid\n        const ttl = Number(store.ttl);\n\n        if (ttl > 0 && ttl < Date.now()) {\n            this.purge();\n            return null;\n        }\n\n        return new Store(store.data);\n    }\n\n    setStore(data, url = null) {\n        // Strip the protocol from the lookup url\n        const key = getKey(url);\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n        let existing = null;\n\n        if (!is.empty(stores)) {\n            // Find existing store by id\n            existing = stores.find(s => s.data.id === data.id);\n        }\n\n        // Extend TTL each\n        const ttl = Date.now() + this.config.ttl;\n\n        // If we found something\n        if (is.object(existing)) {\n            // Update data and extend TTL\n            Object.assign(existing, {\n                data,\n                ttl,\n            });\n\n            if (key !== null) {\n                // Add the URL key for later lookup\n                if (!is.array(existing.urls)) {\n                    existing.urls = [key];\n                } else {\n                    existing.urls.push(key);\n                }\n\n                // Remove duplicate entries\n                const urls = dedupe(existing.urls);\n\n                // Add to existing record\n                Object.assign(existing, {\n                    urls,\n                });\n            }\n        } else {\n            const store = {\n                data,\n                ttl,\n            };\n\n            if (key !== null) {\n                Object.assign(store, {\n                    urls: [key],\n                });\n            }\n\n            stores.push(store);\n        }\n\n        this.set(this.config.keys.stores, stores);\n    }\n}\n\nexport default Storage;\n"]}